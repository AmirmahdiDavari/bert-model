<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø­ØµÙˆÙ„</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Vazir', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9f9f9;
            text-align: center;
        }
        .product-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            text-align: right;
            direction: rtl;
        }
        .product-image {
            flex: 1;
            text-align: center;
        }
        .product-image img {
            width: 200px;
            border-radius: 10px;
        }
        .product-info {
            flex: 2;
            padding-right: 20px;
            width: 550px;
            height: 300px;
        }
        .chart-container {
            flex: 1;
            width: 600px;
            height: 300px;
        }
        .comments {
            text-align: right;
            direction: rtl;
        }
        .comment {
            background: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
        }
        .back-button {
            position: absolute; /* Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡ Ø¨Ù‡ ØµÙˆØ±Øª Ù…Ø·Ù„Ù‚ */
            top: 20px; /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø¨Ø§Ù„Ø§ */
            left: 20px; /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ú†Ù¾ */
            padding: 10px;
            background-color: #007bff; /* Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¯Ú©Ù…Ù‡ */
            color: white; /* Ø±Ù†Ú¯ Ù…ØªÙ† Ø¯Ú©Ù…Ù‡ */
            text-decoration: none; /* Ø­Ø°Ù Ø²ÛŒØ±Ø®Ø· */
            border-radius: 5px; /* Ú¯ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ø¯ */
            transition: background-color 0.3s; /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ */
        }

        .back-button:hover {
            background-color: #ffffff; /* Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¯Ú©Ù…Ù‡ Ø¯Ø± Ø­Ø§Ù„Øª Ù‡Ø§ÙˆØ± */
        }

        .back-icon {
            font-size: 24px; /* Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¢ÛŒÚ©ÙˆÙ† */
            color: #000000; /* Ø±Ù†Ú¯ Ø¢ÛŒÚ©ÙˆÙ† */
            text-decoration: none; /* Ø­Ø°Ù Ø²ÛŒØ±Ø®Ø· */
        }

        .emoji {
            font-size: 20px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
<a href="/" class="back-button">
    <i class="fas fa-arrow-left back-icon"></i> <!-- Ø¢ÛŒÚ©ÙˆÙ† Ø¨Ø§Ø²Ú¯Ø´Øª -->
</a>
    <h2>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ØµÙˆÙ„</h2>
    <div class="product-container">
            <div class="product-container">

        <div class="product-image">
            <img id="product-image" src="" alt="ØªØµÙˆÛŒØ± Ù…Ø­ØµÙˆÙ„">
        </div>
        <div class="product-info">
            <h3 id="product-name">Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„</h3>
            <p><strong>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:</strong> <span id="product-category"></span></p>
            <p><strong>Ù‚ÛŒÙ…Øª:</strong> <span id="product-price"></span> Ø±ÛŒØ§Ù„</p>
            <p><strong>Ø§Ù…ØªÛŒØ§Ø²:</strong> <span id="product-rating"></span></p>
            <p><strong>ØªØ¹Ø¯Ø§Ø¯ Ù†Ø¸Ø±Ø§Øª:</strong> <span id="total-reviews"></span></p>
            <p><strong>ÙØ±ÙˆØ´Ú¯Ø§Ù‡:</strong> <span id="store-name"></span></p>
        </div></div>
        <div>
        <div class="product-container">

        <div class="chart-container">
            <canvas id="sentimentChart"></canvas>
        </div>
        </div>
        </div>
    </div>


    <h2>Ù†Ø¸Ø±Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>
    <div class="comments" id="comments-container">
        <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
    </div>

<script>
    document.addEventListener("DOMContentLoaded", async function () {
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get("product_id");
        const storeName = urlParams.get("store_name");

        if (!productId || !storeName) {
            document.getElementById("comments-container").innerHTML = "<p>Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯Ù‡ Ø§Ø³Øª!</p>";
            return;
        }

        document.getElementById("store-name").textContent = decodeURIComponent(storeName);

        try {
            const productResponse = await fetch(`http://localhost:8000/product/${productId}/`);
            if (!productResponse.ok) {
                throw new Error("Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ØµÙˆÙ„ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª");
            }

            const productData = await productResponse.json();
            document.getElementById("product-name").textContent = productData.name;
            document.getElementById("product-category").textContent = productData.category;
            document.getElementById("product-price").textContent = productData.price.toLocaleString();
            document.getElementById("product-rating").textContent = productData.rating;
            document.getElementById("total-reviews").textContent = productData.total_reviews;
            document.getElementById("product-image").src = productData.image;
            document.getElementById("product-image").alt = productData.name;

            const reviewsResponse = await fetch(`http://localhost:8000/product_reviews/${productId}/${storeName}/`);
            if (!reviewsResponse.ok) {
                throw new Error("Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù†Ø¸Ø±Ø§Øª Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª");
            }

            const reviews = await reviewsResponse.json();
            const commentsContainer = document.getElementById("comments-container");
            commentsContainer.innerHTML = "";

            let sentimentCounts = { "0": 0, "1": 0, "2": 0, "unknown": 0 };

            reviews.forEach(review => {
                let div = document.createElement("div");
                div.classList.add("comment");

                let emoji = document.createElement("span");
                emoji.classList.add("emoji");

                if (review.sentiment === 2) {
                    emoji.textContent = "ğŸ˜Š";
                    sentimentCounts["2"]++;
                } else if (review.sentiment === 1) {
                    emoji.textContent = "ğŸ˜";
                    sentimentCounts["1"]++;
                } else if (review.sentiment === 0) {
                    emoji.textContent = "ğŸ˜¡";
                    sentimentCounts["0"]++;
                } else {
                    emoji.textContent = "â“";
                    sentimentCounts["unknown"]++;
                }

                div.appendChild(emoji);
                div.innerHTML += `<p><strong>Ù†Ø¸Ø±:</strong> ${review.text}</p>`;
                commentsContainer.appendChild(div);
            });

            new Chart(document.getElementById("sentimentChart"), {
                type: 'bar',
                data: {
                    labels: ['Ù…Ù†ÙÛŒ', 'Ù…Ù…ØªÙ†Ø¹', 'Ù…Ø«Ø¨Øª', 'Ù†Ø§Ù…Ø´Ø®Øµ'],
                    datasets: [{
                        label: 'ØªØ¹Ø¯Ø§Ø¯ Ù†Ø¸Ø±Ø§Øª',
                        data: [sentimentCounts["0"], sentimentCounts["1"], sentimentCounts["2"], sentimentCounts["unknown"]],
                        backgroundColor: ['red', 'gray', 'green', 'blue']
                    }]
                }
            });

        } catch (error) {
            document.getElementById("comments-container").innerHTML = `<p style="color:red;">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§: ${error.message}</p>`;
        }
    });
</script>
</body>
</html>
